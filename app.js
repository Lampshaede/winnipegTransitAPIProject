const APIKey="36DdV7a4Ka1tyr8VyrGz",defaultURL="https://api.winnipegtransit.com/v3/",searchType={street:"streets:",streetStops:"stops",schedule:"stops/"},streetsList=document.querySelector(".streets"),stopsTable=document.querySelector("tbody"),parameters="&usage=long",getQuery=async(e,t)=>{let s=e,r="",n="";t===searchType.schedule&&(r="/schedule"),t===searchType.streetStops&&(n=`street=${e}`,s="");const a=await fetch(`${defaultURL}${t}${s}${r}.json?${n}&api-key=${APIKey}${parameters}`);t=await a.json();if(200!==a.status)throw new Error(`Status ${a.status}`);return t},renderSidebar=function(e){if(clearElement(streetsList),0!==e.length)for(var t of e)addResultToSidebar(t);else streetsList.insertAdjacentHTML("afterbegin","<span>Sorry, no results<span>")},clearElement=function(e){let t=e.firstElementChild;for(;t;)e.removeChild(t),t=e.firstElementChild},addResultToSidebar=function(e){streetID=e.key,street=e.name,streetsList.insertAdjacentHTML("afterbegin",`<a href="#" data-street-key="${streetID}">${street}</a>`)},renderContent=function(e,t){clearElement(stopsTable);for(var s of e)crossStreet=s["stop-schedule"].stop["cross-street"].name,direction=s["stop-schedule"].stop.direction,busRoute=s["stop-schedule"]["route-schedules"][0].route.number,time=s["stop-schedule"]["route-schedules"][0]["scheduled-stops"][0].times.arrival.estimated,stopsTable.insertAdjacentHTML("beforeend",`
  <tr><td>${t}</td><td>${crossStreet}</td><td>${direction}</td><td>${busRoute}</td><td>${time}</td></tr>`)};document.querySelector("input").addEventListener("keydown",function(e){"Enter"!==e.code&&"NumpadEnter"!==e.code||(e.preventDefault(),data=getQuery(e.target.value,searchType.street),data.then(e=>{renderSidebar(e.streets)}))}),document.querySelector("section.streets").addEventListener("click",function(e){var t=e.target.getAttribute("data-street-key");document.querySelector("#street-name").textContent=`Displaying results for ${e.target.textContent}`,null!==t&&(data=getQuery(t,searchType.streetStops),data.then(e=>{let t=[];for(var s of e.stops)t.push(getQuery(s.key,searchType.schedule));Promise.all(t).then(e=>{var t=e[0]["stop-schedule"].stop.name;renderContent(e,t)}).catch(e=>{})}))}),clearElement(stopsTable),clearElement(streetsList),document.querySelector("#street-name").textContent="No Results";